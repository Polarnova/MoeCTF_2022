# MoeCTF 2022 / signin

## 初见

哎呀这不是rsa吗，不愧是签到捏，连pqc都给了

```python
from Crypto.Util.number import inverse, long_to_bytes

q = 12408795636519868275579286477747181009018504169827579387457997229774738126230652970860811085539129972962189443268046963335610845404214331426857155412988073
p = 12190036856294802286447270376342375357864587534233715766210874702670724440751066267168907565322961270655972226761426182258587581206888580394726683112820379
c = 68960610962019321576894097705679955071402844421318149418040507036722717269530195000135979777852568744281930839319120003106023209276898286482202725287026853925179071583797231099755287410760748104635674307266042492611618076506037004587354018148812584502385622631122387857218023049204722123597067641896169655595
e = 65537
n = p*q

phi = (p-1)*(q-1)
d = inverse(e,phi)
m = pow(c,d,n)
assert pow(m,e,n) == c
```

执行，miaoshale...嗯？？？？？？怎么AssertionError了？？？？？？

我真傻，真的，我光知道可以求通过phi求逆元，**不知道phi要和e互质**

## 研究

(!!!警告 以下将有暴力非预期出现!!!)

### 解法一：AMM算法暴力破解（非预期）

网上关于AMM算法的文章并不多，~~你让我讲我也讲不清楚~~

直接上代码！

[完整代码](./amm.py)

```python
def AMM(x, e, p):
    assert p%e !=0 and (p-1) % e == 0
    y = 2
    assert not (pow(y, (p - 1) // e, p) == 1)
    s = p // e
    k = 1
    while ((s * k + 1) % e != 0):
        k += 1
    a = pow(y,  s, p)
    root = pow(x, (s * k + 1) // e, p)
    for i in range(e):
        item = root * pow(a, i, p) % p
        txt = long_to_bytes(item)
        if b'moectf' in txt: # 这里是对结果进行筛选
            return txt
```

然后就求得flag了

### 解法二：还是暴力解（非预期）

也是直接上代码（怎么来的已经忘记了orz）

[完整代码](./exp2.py)

```python
l = (p-1)*(q-1)//GCD(p-1,q-1)
d = inverse(e,l//e)
k = 1
while True:
    L = pow(k,l//e,n)
    if L!=1:
        break
    k+=1
cd = pow(c,d,n)
for i in range(e):
    P = (cd * pow(L,i,n)) % n
    txt = long_to_bytes(P)
    if b"moectf" in txt:
        print(txt)
        break
```

这个比AMM慢一点，大概三秒出结果

### 解法三

这个虽然是预期解，但是对于我这种没基础的人，确实也是很难想到的

还是直接上代码

[完整代码](./exp.py)

```python
d = inverse(e,(q-1))
m = pow(c,d,q)
print(long_to_bytes(c))
```

嗯......就这点owo

具体思路是，既然 p-1 与 e 不互质，那就以 q 为模，求得 phi=q-1，即可接着求逆元和原文